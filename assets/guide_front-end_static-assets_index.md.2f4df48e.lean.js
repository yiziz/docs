import{_ as e,c as a,a as s,b as n,t as i,d as o,o as p}from"./app.4e698dd0.js";const b='{"title":"Static Assets","description":"","frontmatter":{"title":"Static Assets"},"headers":[{"level":2,"title":"Rollup plugin","slug":"rollup-plugin"},{"level":2,"title":"Configuration","slug":"configuration"},{"level":3,"title":"Properties","slug":"properties"},{"level":2,"title":"How this works","slug":"how-this-works"}],"relativePath":"guide/front-end/static-assets/index.md","lastUpdated":1636354420388}',r={},l={id:"frontmatter-title",tabindex:"-1"},c=s("a",{class:"header-anchor",href:"#frontmatter-title","aria-hidden":"true"},"#",-1),d=o(`__VP_STATIC_START__<p>Vite handles static assets natively which is great because it eliminates the need for clunky configurations and maintenance. A downside to how it does manage assets, however, is by default it serves them using an absolute path and without an origin. When using the DevServer, this results in your static assets being loaded from AEM rather than Vite.</p><p>To overcome this, the existing <code>@aem-vite/import-rewriter</code> plugin has been updated to include an additional rewriter for CSS files.</p><h2 id="rollup-plugin" tabindex="-1">Rollup plugin <a class="header-anchor" href="#rollup-plugin" aria-hidden="true">#</a></h2><p>To get started, simply add <code>@aem-vite/import-rewriter</code> as a dependency in your project.</p><div class="language-bash"><pre><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev @aem-vite/import-rewriter
<span class="token comment"># or; yarn</span>
<span class="token function">yarn</span> <span class="token function">add</span> -D @aem-vite/import-rewriter
</code></pre></div><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-hidden="true">#</a></h2><p>Getting this plugin configured is really simple, all it requires is the local assets path and your ClientLib public path.</p><p>As can be seen below, <code>publicPath</code> checks the Vite <code>command</code> that was executed and applies either the Vite DevServer URL or the AEM ClientLib public path. This is important as when using the DevServer, a clear distintion is needed to ensure Vite is serving assets rather than AEM.</p><div class="language-js"><div class="highlight-lines"><div class="highlighted">\xA0</div><br><br><br><br><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><div class="highlighted">\xA0</div><br><br><br></div><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> aemViteCSSImportRewriter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@aem-vite/import-rewriter&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> command <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ... all other plugins before, &#39;aemViteCSSImportRewriter&#39; must be last</span>
    <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">aemViteCSSImportRewriter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        assetsBasePath<span class="token operator">:</span> <span class="token string">&#39;/src/assets&#39;</span><span class="token punctuation">,</span>
        publicPath<span class="token operator">:</span> command <span class="token operator">===</span> <span class="token string">&#39;serve&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;http://localhost:3000/assets&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;/etc.clientlibs/&lt;project&gt;/clientlibs/&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

      enforce<span class="token operator">:</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">Why does &#39;publicPath&#39; use different paths?</p><p>As mentioned, Vite will serve assets from <code>/</code>. The import rewriter will use the path you provide to ensure assets are served from the correct location.</p></div><h3 id="properties" tabindex="-1">Properties <a class="header-anchor" href="#properties" aria-hidden="true">#</a></h3><table><thead><tr><th style="text-align:left;">Property Name</th><th>Type</th><th>Required</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>assetsBasePath</strong><br><small>The absolute path used in your CSS to load static assets.</small></td><td><code>string</code></td><td>Yes</td></tr><tr><td style="text-align:left;"><strong>publicPath</strong><br><small>The AEM proxy path to your ClientLibs directory; or the Vite DevServer path when working locally.</small></td><td><code>string</code></td><td>Yes</td></tr></tbody></table><h2 id="how-this-works" tabindex="-1">How this works <a class="header-anchor" href="#how-this-works" aria-hidden="true">#</a></h2><p>Nothing too complex is going on here, <code>aemViteCSSImportRewriter</code> will simply find and replace all instances of the <code>assetsBasePath</code> with the provided <code>publicPath</code>. This process is extremely quick and occurs during Rollup&#39;s <code>transform</code> stage which is just before the file is written.</p><p>After that, it is all pure magic!</p>__VP_STATIC_END__`,15);function h(t,u,g,k,m,v){return p(),a("div",null,[s("h1",l,[n(i(t.$frontmatter.title)+" ",1),c]),d])}var w=e(r,[["render",h]]);export{b as __pageData,w as default};
